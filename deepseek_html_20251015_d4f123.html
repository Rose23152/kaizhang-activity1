<script>
async function submitForm() {
  const name = document.getElementById('name').value.trim();
  const region = document.getElementById('region').value;
  const temple = document.getElementById('temple').value;
  
  if (!name || !region || !temple) {
    alert('è«‹å¡«å¯«å®Œæ•´è³‡æ–™ï¼');
    return;
  }

  // å¿«é€Ÿç”¢ç”ŸæŠ½çè™Ÿç¢¼
  let hash = 0;
  for (let i = 0; i < name.length; i++) {
    hash = ((hash << 5) - hash) + name.charCodeAt(i);
    hash = hash & hash;
  }
  const number = Math.abs(hash) % 999 + 1;
  
  // ç«‹å³é¡¯ç¤ºçµæœçµ¦ä½¿ç”¨è€…
  const result = document.getElementById('result');
  result.innerHTML = `
    <h3 style="text-align: center; color: #4caf50;">ğŸ‰ ç™»éŒ„æˆåŠŸï¼</h3>
    <div class="lottery-number">${number.toString().padStart(3, '0')}</div>
    <p><strong>å§“åï¼š</strong>${name}</p>
    <p><strong>åœ°å€ï¼š</strong>${region}</p>
    <p><strong>å®®å»Ÿï¼š</strong>${temple}</p>
    <p><strong>æ™‚é–“ï¼š</strong>${new Date().toLocaleString('zh-TW')}</p>
    <p style="color: #d32f2f; font-weight: bold; text-align: center;">ğŸ“¸ è«‹å‹™å¿…æˆªåœ–ä¿å­˜æŠ½çè™Ÿç¢¼ï¼</p>
  `;
  result.style.display = 'block';
  
  // èƒŒæ™¯å‚³é€åˆ°é›²ç«¯ï¼ˆä¸å½±éŸ¿ä½¿ç”¨è€…ï¼‰
  setTimeout(() => {
    const submission = {
      lotteryNumber: number,
      name: name,
      region: region,
      temple: temple,
      timestamp: new Date().toLocaleString('zh-TW')
    };
    
    fetch('https://script.google.com/macros/s/AKfycbyZ4dwk6J_gHKjL0Bmsgv8DlCI5qdg2vMWFI-qwpWzWv1P4F2JD3TTW6zUW_iweQS8d7Q/exec', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(submission)
    }).catch(error => {
      console.log('é›²ç«¯å‚™ä»½å¤±æ•—ï¼Œä½†ä¸å½±éŸ¿ä½¿ç”¨è€…');
    });
  }, 100);
}
</script>